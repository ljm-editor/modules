var pt=Object.defineProperty;var et=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable;var it=(t,e,i)=>e in t?pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))bt.call(e,i)&&it(t,i,e[i]);if(et)for(var i of et(e))yt.call(e,i)&&it(t,i,e[i]);return t};import{e as vt,n as xt,h as st}from"./main.a67208f8.js";import{c as wt,W as kt,a as Mt,g as St}from"./index.04e0b753.js";import"./vue-libs.882c34e2.js";const nt=()=>Math.random().toString(32).substring(6);class A{constructor(e){const{id:i=nt(),x:s=4,y:n=4,width:o=100,height:a=100,img:u=void 0,html:c="",bgColor:h="transparent",radius:d=0,link:m=void 0,padding:f=[0,0,0,0]}=e||{};this.id=i,this.x=s,this.y=n,this.width=o,this.height=a,this.img=u,this.imgMode="cover",this.html=c,this.bgColor=h,this.radius=d,this.link=m}clone(){const e=new A(this);return e.id=nt(),e.x+=8,e.y+=20,e}}const[Rt,ot]=wt({name:"free-layout",desc:"\u81EA\u7531\u5E03\u5C40",group:"\u57FA\u7840\u6A21\u5757",visible:!0,tags:["\u81EA\u5B9A\u4E49"],order:10}),Lt={props:{height:{type:Number,default:200,editor:{type:"custom"}},bgColor:{type:String,default:"#fff",editor:{type:"custom"}},bgImg:{type:Object,editor:{type:"custom"}},blocks:{type:Array,default:()=>[new A({bgColor:"rgb(234, 245, 255)"}),new A({x:108,bgColor:"rgb(203, 231, 254)"}),new A({x:212,bgColor:"rgb(152, 205, 253)"})],editor:{type:"custom"}}},triggers:{onClickBlock:"click:block"},computed:{containerStyle(){const[,t,,e]=this.wrapPadding,{height:i,bgColor:s,bgImg:n}=this,a={width:this.addUnit(375-t-e),height:this.addUnit(i),backgroundColor:s};return n&&n.url&&(a.backgroundImage=`url(${n.url})`),a}},methods:{onClick(t){return()=>{const{eventNamespace:e,$options:i}=this,{triggers:s}=i,n=`${e}:${s.onClick}`;vt.emit(n,{data:t})}},renderBlocks(){const t=this.$createElement;return this.blocks.map(e=>t("div",{key:e.id,class:ot("block"),on:{click:this.onClick(e.link)},style:this.getBlockStyle(e,this.addUnit)},[!!e.html&&t("div",{domProps:{innerHTML:e.html}})]))},getBlockStyle(t,e){const{x:i,y:s,width:n,height:o,bgColor:a,img:u,radius:c,imgMode:h}=t,d={left:e(i),top:e(s),width:e(n),height:e(o),backgroundColor:a,borderRadius:e(c)};return u&&u.url&&(d.backgroundImage=`url(${u.url})`),d}},render(){const t=arguments[0];return t(kt,{attrs:{wrapStyle:this.wrapStyle,innerStyle:this.wrapInnerStyle}},[t("div",{class:ot(),style:this.containerStyle},[this.renderBlocks()])])}};var Tt=Rt(Lt);const Ct=Tt;var ct=Ct;function at(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Function]"}function z(t,e,i,s=1){const n=Math.round(e/s/t[0])*t[0],o=Math.round(i/s/t[1])*t[1];return[n,o]}function Y(t,e,i){return t-e-i}function V(t,e,i){return t-e-i}function v(t,e,i){return e!==null&&t<e?e:i!==null&&i<t?i:t}function ht(t,e,i){let s=t;const n=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find(o=>at(s[o]));if(!at(s[n]))return!1;do{if(s[n](e))return!0;if(s===i)return!1;s=s.parentNode}while(s);return!1}function Pt(t){const e=window.getComputedStyle(t);return[parseFloat(e.getPropertyValue("width"),10),parseFloat(e.getPropertyValue("height"),10)]}function C(t,e,i){!t||(t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener?t.addEventListener(e,i,!0):t["on"+e]=i)}function M(t,e,i){!t||(t.detachEvent?t.detachEvent("on"+e,i):t.removeEventListener?t.removeEventListener(e,i,!0):t["on"+e]=null)}var zt=function(){var t,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{class:[(t={},t[e.classNameActive]=e.enabled,t[e.classNameDragging]=e.dragging,t[e.classNameResizing]=e.resizing,t[e.classNameDraggable]=e.draggable,t[e.classNameResizable]=e.resizable,t),e.className],style:e.style,on:{mousedown:e.elementMouseDown,touchstart:e.elementTouchDown,contextmenu:e.onContextMenu}},[e._l(e.actualHandles,function(n){return s("div",{key:n,class:[e.classNameHandle,e.classNameHandle+"-"+n],style:e.handleStyle(n),on:{mousedown:function(o){return o.stopPropagation(),o.preventDefault(),e.handleDown(n,o)},touchstart:function(o){return o.stopPropagation(),o.preventDefault(),e.handleTouchDown(n,o)}}},[e._t(n)],2)}),e._t("default")],2)},$t=[];const D={mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"},touch:{start:"touchstart",move:"touchmove",stop:"touchend"}},At={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},Bt={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let S=D.mouse;const Ht={replace:!0,name:"vue-draggable-resizable",props:{className:{type:String,default:"vdr"},classNameDraggable:{type:String,default:"draggable"},classNameResizable:{type:String,default:"resizable"},classNameDragging:{type:String,default:"dragging"},classNameResizing:{type:String,default:"resizing"},classNameActive:{type:String,default:"active"},classNameHandle:{type:String,default:"handle"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},lockAspectRatio:{type:Boolean,default:!1},w:{type:[Number,String],default:200,validator:t=>typeof t=="number"?t>0:t==="auto"},h:{type:[Number,String],default:200,validator:t=>typeof t=="number"?t>0:t==="auto"},minWidth:{type:Number,default:0,validator:t=>t>=0},minHeight:{type:Number,default:0,validator:t=>t>=0},maxWidth:{type:Number,default:null,validator:t=>t>=0},maxHeight:{type:Number,default:null,validator:t=>t>=0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:t=>typeof t=="string"?t==="auto":t>=0},handles:{type:Array,default:()=>["tl","tm","tr","mr","br","bm","bl","ml"],validator:t=>{const e=new Set(["tl","tm","tr","mr","br","bm","bl","ml"]);return new Set(t.filter(i=>e.has(i))).size===t.length}},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},axis:{type:String,default:"both",validator:t=>["x","y","both"].includes(t)},grid:{type:Array,default:()=>[1,1]},parent:{type:[Boolean,String],default:!1},onDragStart:{type:Function,default:()=>!0},onDrag:{type:Function,default:()=>!0},onResizeStart:{type:Function,default:()=>!0},onResize:{type:Function,default:()=>!0},isConflictCheck:{type:Boolean,default:!1},snap:{type:Boolean,default:!1},snapTolerance:{type:Number,default:5,validator(t){return typeof t=="number"}},scaleRatio:{type:Number,default:1,validator:t=>typeof t=="number"},handleInfo:{type:Object,default:()=>({size:8,offset:-5,switch:!0})}},data(){return{left:this.x,top:this.y,right:null,bottom:null,width:null,height:null,widthTouched:!1,heightTouched:!1,aspectFactor:null,parentWidth:null,parentHeight:null,minW:this.minWidth,minH:this.minHeight,maxW:this.maxWidth,maxH:this.maxHeight,handle:null,enabled:this.active,resizing:!1,dragging:!1,zIndex:this.z}},computed:{handleStyle(){return t=>{if(!this.handleInfo.switch)return{display:this.enabled?"block":"none"};const e=(this.handleInfo.size/this.scaleRatio).toFixed(2),i=(this.handleInfo.offset/this.scaleRatio).toFixed(2),s=(e/2).toFixed(2),n={tl:{top:`${i}px`,left:`${i}px`},tm:{top:`${i}px`,left:`calc(50% - ${s}px)`},tr:{top:`${i}px`,right:`${i}px`},mr:{top:`calc(50% - ${s}px)`,right:`${i}px`},br:{bottom:`${i}px`,right:`${i}px`},bm:{bottom:`${i}px`,right:`calc(50% - ${s}px)`},bl:{bottom:`${i}px`,left:`${i}px`},ml:{top:`calc(50% - ${s}px)`,left:`${i}px`}},o={width:`${e}px`,height:`${e}px`,top:n[t].top,left:n[t].left,right:n[t].right,bottom:n[t].bottom};return o.display=this.enabled?"block":"none",o}},style(){return X({transform:`translate(${this.left}px, ${this.top}px)`,width:this.computedWidth,height:this.computedHeight,zIndex:this.zIndex},this.dragging&&this.disableUserSelect?At:Bt)},actualHandles(){return this.resizable?this.handles:[]},computedWidth(){return this.w==="auto"&&!this.widthTouched?"auto":this.width+"px"},computedHeight(){return this.h==="auto"&&!this.heightTouched?"auto":this.height+"px"},resizingOnX(){return Boolean(this.handle)&&(this.handle.includes("l")||this.handle.includes("r"))},resizingOnY(){return Boolean(this.handle)&&(this.handle.includes("t")||this.handle.includes("b"))},isCornerHandle(){return Boolean(this.handle)&&["tl","tr","br","bl"].includes(this.handle)}},watch:{active(t){this.enabled=t,t?this.$emit("activated"):this.$emit("deactivated")},z(t){(t>=0||t==="auto")&&(this.zIndex=t)},x(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveHorizontally(t))},y(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveVertically(t))},lockAspectRatio(t){t?this.aspectFactor=this.width/this.height:this.aspectFactor=void 0},minWidth(t){t>0&&t<=this.width&&(this.minW=t)},minHeight(t){t>0&&t<=this.height&&(this.minH=t)},maxWidth(t){this.maxW=t},maxHeight(t){this.maxH=t},w(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeWidth(t))},h(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeHeight(t))}},created(){this.maxWidth&&this.minWidth>this.maxWidth&&console.warn("[Vdr warn]: Invalid prop: minWidth cannot be greater than maxWidth"),this.maxWidth&&this.minHeight>this.maxHeight&&console.warn("[Vdr warn]: Invalid prop: minHeight cannot be greater than maxHeight"),this.resetBoundsAndMouseState()},mounted(){this.enableNativeDrag||(this.$el.ondragstart=()=>!1);const[t,e]=this.getParentSize();this.parentWidth=t,this.parentHeight=e;const[i,s]=Pt(this.$el);this.aspectFactor=(this.w!=="auto"?this.w:i)/(this.h!=="auto"?this.h:s),this.width=this.w!=="auto"?this.w:i,this.height=this.h!=="auto"?this.h:s,this.right=this.parentWidth-this.width-this.left,this.bottom=this.parentHeight-this.height-this.top,this.settingAttribute();const n=this.$el.parentNode;C(n||document.documentElement,"mousedown",this.deselect),C(n||document.documentElement,"touchend touchcancel",this.deselect),C(window,"resize",this.checkParentSize)},beforeDestroy(){M(document.documentElement,"mousedown",this.deselect),M(document.documentElement,"touchstart",this.handleUp),M(document.documentElement,"mousemove",this.move),M(document.documentElement,"touchmove",this.move),M(document.documentElement,"mouseup",this.handleUp),M(document.documentElement,"touchend touchcancel",this.deselect),M(window,"resize",this.checkParentSize)},methods:{onContextMenu(t){this.$emit("contextmenu",t)},resetBoundsAndMouseState(){this.mouseClickPosition={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},this.bounds={minLeft:null,maxLeft:null,minRight:null,maxRight:null,minTop:null,maxTop:null,minBottom:null,maxBottom:null}},checkParentSize(){if(this.parent){const[t,e]=this.getParentSize();this.right=t-this.width-this.left,this.bottom=e-this.height-this.top,this.parentWidth=t,this.parentHeight=e}},getParentSize(){if(this.parent===!0){const t=window.getComputedStyle(this.$el.parentNode,null);return[parseInt(t.getPropertyValue("width"),10),parseInt(t.getPropertyValue("height"),10)]}if(typeof this.parent=="string"){const t=document.querySelector(this.parent);if(!(t instanceof HTMLElement))throw new Error(`The selector ${this.parent} does not match any element`);return[t.offsetWidth,t.offsetHeight]}return[null,null]},elementTouchDown(t){S=D.touch,this.elementDown(t)},elementMouseDown(t){S=D.mouse,this.elementDown(t)},elementDown(t){if(t instanceof MouseEvent&&t.which!==1)return;const e=t.target||t.srcElement;if(this.$el.contains(e)){if(this.onDragStart(t)===!1)return;if(this.dragHandle&&!ht(e,this.dragHandle,this.$el)||this.dragCancel&&ht(e,this.dragCancel,this.$el)){this.dragging=!1;return}this.enabled||(this.enabled=!0,this.$emit("activated")),this.draggable&&(this.dragging=!0),this.mouseClickPosition.mouseX=t.touches?t.touches[0].pageX:t.pageX,this.mouseClickPosition.mouseY=t.touches?t.touches[0].pageY:t.pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.mouseClickPosition.w=this.width,this.mouseClickPosition.h=this.height,this.parent&&(this.bounds=this.calcDragLimits()),C(document.documentElement,S.move,this.move),C(document.documentElement,S.stop,this.handleUp)}},calcDragLimits(){return{minLeft:this.left%this.grid[0],maxLeft:Math.floor((this.parentWidth-this.width-this.left)/this.grid[0])*this.grid[0]+this.left,minRight:this.right%this.grid[0],maxRight:Math.floor((this.parentWidth-this.width-this.right)/this.grid[0])*this.grid[0]+this.right,minTop:this.top%this.grid[1],maxTop:Math.floor((this.parentHeight-this.height-this.top)/this.grid[1])*this.grid[1]+this.top,minBottom:this.bottom%this.grid[1],maxBottom:Math.floor((this.parentHeight-this.height-this.bottom)/this.grid[1])*this.grid[1]+this.bottom}},deselect(t){const e=t.target||t.srcElement,i=new RegExp(this.className+"-([trmbl]{2})","");!this.$el.contains(e)&&!i.test(e.className)&&(this.enabled&&!this.preventDeactivation&&(this.enabled=!1,this.$emit("deactivated")),M(document.documentElement,S.move,this.handleResize)),this.resetBoundsAndMouseState()},handleTouchDown(t,e){S=D.touch,this.handleDown(t,e)},handleDown(t,e){e instanceof MouseEvent&&e.which!==1||this.onResizeStart(t,e)!==!1&&(e.stopPropagation&&e.stopPropagation(),this.lockAspectRatio&&!t.includes("m")?this.handle="m"+t.substring(1):this.handle=t,this.resizing=!0,this.mouseClickPosition.mouseX=e.touches?e.touches[0].pageX:e.pageX,this.mouseClickPosition.mouseY=e.touches?e.touches[0].pageY:e.pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.mouseClickPosition.w=this.width,this.mouseClickPosition.h=this.height,this.bounds=this.calcResizeLimits(),C(document.documentElement,S.move,this.handleResize),C(document.documentElement,S.stop,this.handleUp))},calcResizeLimits(){let{minW:t}=this,{minH:e}=this,{maxW:i}=this,{maxH:s}=this;const{aspectFactor:n}=this,[o,a]=this.grid,{width:u}=this,{height:c}=this,{left:h}=this,{top:d}=this,{right:m}=this,{bottom:f}=this;this.lockAspectRatio&&(t/e>n?e=t/n:t=n*e,i&&s?(i=Math.min(i,n*s),s=Math.min(s,i/n)):i?s=i/n:s&&(i=n*s)),i-=i%o,s-=s%a;const r={minLeft:null,maxLeft:null,minTop:null,maxTop:null,minRight:null,maxRight:null,minBottom:null,maxBottom:null};return this.parent?(r.minLeft=h%o,r.maxLeft=h+Math.floor((u-t)/o)*o,r.minTop=d%a,r.maxTop=d+Math.floor((c-e)/a)*a,r.minRight=m%o,r.maxRight=m+Math.floor((u-t)/o)*o,r.minBottom=f%a,r.maxBottom=f+Math.floor((c-e)/a)*a,i&&(r.minLeft=Math.max(r.minLeft,this.parentWidth-m-i),r.minRight=Math.max(r.minRight,this.parentWidth-h-i)),s&&(r.minTop=Math.max(r.minTop,this.parentHeight-f-s),r.minBottom=Math.max(r.minBottom,this.parentHeight-d-s)),this.lockAspectRatio&&(r.minLeft=Math.max(r.minLeft,h-d*n),r.minTop=Math.max(r.minTop,d-h/n),r.minRight=Math.max(r.minRight,m-f*n),r.minBottom=Math.max(r.minBottom,f-m/n))):(r.minLeft=null,r.maxLeft=h+Math.floor((u-t)/o)*o,r.minTop=null,r.maxTop=d+Math.floor((c-e)/a)*a,r.minRight=null,r.maxRight=m+Math.floor((u-t)/o)*o,r.minBottom=null,r.maxBottom=f+Math.floor((c-e)/a)*a,i&&(r.minLeft=-(m+i),r.minRight=-(h+i)),s&&(r.minTop=-(f+s),r.minBottom=-(d+s)),this.lockAspectRatio&&i&&s&&(r.minLeft=Math.min(r.minLeft,-(m+i)),r.minTop=Math.min(r.minTop,-(s+f)),r.minRight=Math.min(r.minRight,-h-i),r.minBottom=Math.min(r.minBottom,-d-s))),r},move(t){this.resizing?this.handleResize(t):this.dragging&&this.handleDrag(t)},async handleDrag(t){const{axis:e}=this,{grid:i}=this,{bounds:s}=this,{mouseClickPosition:n}=this,o=e&&e!=="y"?n.mouseX-(t.touches?t.touches[0].pageX:t.pageX):0,a=e&&e!=="x"?n.mouseY-(t.touches?t.touches[0].pageY:t.pageY):0,[u,c]=z(i,o,a,this.scaleRatio),h=v(n.left-u,s.minLeft,s.maxLeft),d=v(n.top-c,s.minTop,s.maxTop);if(this.onDrag(h,d)===!1)return;const m=v(n.right+u,s.minRight,s.maxRight),f=v(n.bottom+c,s.minBottom,s.maxBottom);this.left=h,this.top=d,this.right=m,this.bottom=f,await this.snapCheck(),this.$emit("dragging",this.left,this.top)},moveHorizontally(t){const[e,i]=z(this.grid,t,this.top,this.scale),s=v(e,this.bounds.minLeft,this.bounds.maxLeft);this.left=s,this.right=this.parentWidth-this.width-s},moveVertically(t){const[e,i]=z(this.grid,this.left,t,this.scale),s=v(i,this.bounds.minTop,this.bounds.maxTop);this.top=s,this.bottom=this.parentHeight-this.height-s},handleResize(t){let{left:e}=this,{top:i}=this,{right:s}=this,{bottom:n}=this;const{mouseClickPosition:o}=this,{aspectFactor:a}=this,u=o.mouseX-(t.touches?t.touches[0].pageX:t.pageX),c=o.mouseY-(t.touches?t.touches[0].pageY:t.pageY);!this.widthTouched&&u&&(this.widthTouched=!0),!this.heightTouched&&c&&(this.heightTouched=!0);const[h,d]=z(this.grid,u,c,this.scaleRatio);this.handle.includes("b")?(n=v(o.bottom+d,this.bounds.minBottom,this.bounds.maxBottom),this.lockAspectRatio&&this.resizingOnY&&(s=this.right-(this.bottom-n)*a)):this.handle.includes("t")&&(i=v(o.top-d,this.bounds.minTop,this.bounds.maxTop),this.lockAspectRatio&&this.resizingOnY&&(e=this.left-(this.top-i)*a)),this.handle.includes("r")?(s=v(o.right+h,this.bounds.minRight,this.bounds.maxRight),this.lockAspectRatio&&this.resizingOnX&&(n=this.bottom-(this.right-s)/a)):this.handle.includes("l")&&(e=v(o.left-h,this.bounds.minLeft,this.bounds.maxLeft),this.lockAspectRatio&&this.resizingOnX&&(i=this.top-(this.left-e)/a));const m=Y(this.parentWidth,e,s),f=V(this.parentHeight,i,n);this.onResize(this.handle,e,i,m,f)!==!1&&(this.left=e,this.top=i,this.right=s,this.bottom=n,this.width=m,this.height=f,this.$emit("resizing",this.left,this.top,this.width,this.height))},changeWidth(t){const[e,i]=z(this.grid,t,0,this.scale),s=v(this.parentWidth-e-this.left,this.bounds.minRight,this.bounds.maxRight);let{bottom:n}=this;this.lockAspectRatio&&(n=this.bottom-(this.right-s)/this.aspectFactor);const o=Y(this.parentWidth,this.left,s),a=V(this.parentHeight,this.top,n);this.right=s,this.bottom=n,this.width=o,this.height=a},changeHeight(t){const[e,i]=z(this.grid,0,t,this.scale),s=v(this.parentHeight-i-this.top,this.bounds.minBottom,this.bounds.maxBottom);let{right:n}=this;this.lockAspectRatio&&(n=this.right-(this.bottom-s)*this.aspectFactor);const o=Y(this.parentWidth,this.left,n),a=V(this.parentHeight,this.top,s);this.right=n,this.bottom=s,this.width=o,this.height=a},async handleUp(t){this.handle=null;const e=new Array(3).fill({display:!1,position:"",origin:"",lineLength:""}),i={vLine:[],hLine:[]};for(const s in i)i[s]=JSON.parse(JSON.stringify(e));this.resizing&&(this.resizing=!1,await this.conflictCheck(),this.$emit("refLineParams",i),this.$emit("resizestop",this.left,this.top,this.width,this.height)),this.dragging&&(this.dragging=!1,await this.conflictCheck(),this.$emit("refLineParams",i),this.$emit("dragstop",this.left,this.top)),this.resetBoundsAndMouseState(),M(document.documentElement,S.move,this.handleResize)},settingAttribute(){this.$el.setAttribute("data-is-check",`${this.isConflictCheck}`),this.$el.setAttribute("data-is-snap",`${this.snap}`)},conflictCheck(){const{top:t}=this,{left:e}=this,{width:i}=this,{height:s}=this;if(this.isConflictCheck){const n=this.$el.parentNode.childNodes;for(const o of n)if(o.className!==void 0&&!o.className.includes(this.classNameActive)&&o.getAttribute("data-is-check")!==null&&o.getAttribute("data-is-check")!=="false"){const a=o.offsetWidth,u=o.offsetHeight,[c,h]=this.formatTransformVal(o.style.transform),d=t>=h&&e>=c&&h+u>t&&c+a>e||t<=h&&e<c&&t+s>h&&e+i>c,m=e<=c&&t>=h&&e+i>c&&t<h+u||t<h&&e>c&&t+s>h&&e<c+a,f=t<=h&&e>=c&&t+s>h&&e<c+a||t>=h&&e<=c&&t<h+u&&e>c+a,r=t<=h&&e>=c&&t+s>h&&e<c+a||t>=h&&e<=c&&t<h+u&&e>c+a,l=e>=c&&t>=h&&e<c+a&&t<h+u||t>h&&e<=c&&e+i>c&&t<h+u,g=t<=h&&e>=c&&t+s>h&&e<c+a||t>=h&&e<=c&&t<h+u&&e+i>c;(d||m||f||r||l||g)&&(this.top=this.mouseClickPosition.top,this.left=this.mouseClickPosition.left,this.right=this.mouseClickPosition.right,this.bottom=this.mouseClickPosition.bottom,this.width=this.mouseClickPosition.w,this.height=this.mouseClickPosition.h,this.$emit("resizing",this.left,this.top,this.width,this.height))}}},async snapCheck(){let{width:t}=this,{height:e}=this;if(this.snap){let i=this.left,s=this.left+t,n=this.top,o=this.top+e;const a=new Array(3).fill({display:!1,position:"",origin:"",lineLength:""}),u={vLine:[],hLine:[]};for(const g in u)u[g]=JSON.parse(JSON.stringify(a));const c=this.$el.parentNode.childNodes,h={value:{x:[[],[],[]],y:[[],[],[]]},display:[],position:[]},{groupWidth:d,groupHeight:m,groupLeft:f,groupTop:r,bln:l}=await this.getActiveAll(c);l||(t=d,e=m,i=f,s=f+d,n=r,o=r+m);for(const g of c)if(g.className!==void 0&&!g.className.includes(this.classNameActive)&&g.getAttribute("data-is-snap")!==null&&g.getAttribute("data-is-snap")!=="false"){const H=g.offsetWidth,N=g.offsetHeight,[p,b]=this.formatTransformVal(g.style.transform),x=p+H,w=b+N,F=Math.abs(n+e/2-(b+N/2))<=this.snapTolerance,_=Math.abs(i+t/2-(p+H/2))<=this.snapTolerance,G=Math.abs(b-o)<=this.snapTolerance,j=Math.abs(w-o)<=this.snapTolerance,J=Math.abs(b-n)<=this.snapTolerance,q=Math.abs(w-n)<=this.snapTolerance,K=Math.abs(p-s)<=this.snapTolerance,Q=Math.abs(x-s)<=this.snapTolerance,Z=Math.abs(p-i)<=this.snapTolerance,tt=Math.abs(x-i)<=this.snapTolerance;h.display=[G,j,J,q,F,F,K,Q,Z,tt,_,_],h.position=[b,w,b,w,b+N/2,b+N/2,p,x,p,x,p+H/2,p+H/2],G&&(l&&(this.top=Math.max(b-e,this.bounds.minTop),this.bottom=this.parentHeight-this.top-e),h.value.y[0].push(p,x,i,s)),J&&(l&&(this.top=b,this.bottom=this.parentHeight-this.top-e),h.value.y[0].push(p,x,i,s)),j&&(l&&(this.top=Math.max(w-e,this.bounds.minTop),this.bottom=this.parentHeight-this.top-e),h.value.y[1].push(p,x,i,s)),q&&(l&&(this.top=w,this.bottom=this.parentHeight-this.top-e),h.value.y[1].push(p,x,i,s)),K&&(l&&(this.left=Math.max(p-t,this.bounds.minLeft),this.right=this.parentWidth-this.left-t),h.value.x[0].push(b,w,n,o)),Z&&(l&&(this.left=p,this.right=this.parentWidth-this.left-t),h.value.x[0].push(b,w,n,o)),Q&&(l&&(this.left=Math.max(x-t,this.bounds.minLeft),this.right=this.parentWidth-this.left-t),h.value.x[1].push(b,w,n,o)),tt&&(l&&(this.left=x,this.right=this.parentWidth-this.left-t),h.value.x[1].push(b,w,n,o)),F&&(l&&(this.top=Math.max(b+N/2-e/2,this.bounds.minTop),this.bottom=this.parentHeight-this.top-e),h.value.y[2].push(p,x,i,s)),_&&(l&&(this.left=Math.max(p+H/2-t/2,this.bounds.minLeft),this.right=this.parentWidth-this.left-t),h.value.x[2].push(b,w,n,o));const P=[0,1,0,1,2,2,0,1,0,1,2,2];for(let y=0;y<=P.length;y++){const mt=y<6?"y":"x",W=y<6?"hLine":"vLine";if(h.display[y]){const{origin:ft,length:gt}=this.calcLineValues(h.value[mt][P[y]]);u[W][P[y]].display=h.display[y],u[W][P[y]].position=h.position[y]+"px",u[W][P[y]].origin=ft,u[W][P[y]].lineLength=gt}}}this.$emit("refLineParams",u)}},calcLineValues(t){const e=Math.max(...t)-Math.min(...t)+"px",i=Math.min(...t)+"px";return{length:e,origin:i}},async getActiveAll(t){const e=[],i=[],s=[];let n=0,o=0,a=0,u=0;for(const d of t)d.className!==void 0&&d.className.includes(this.classNameActive)&&e.push(d);const c=e.length;if(c>1){for(const d of e){const m=d.offsetLeft,f=m+d.offsetWidth,r=d.offsetTop,l=r+d.offsetHeight;i.push(r,l),s.push(m,f)}n=Math.max(...s)-Math.min(...s),o=Math.max(...i)-Math.min(...i),a=Math.min(...s),u=Math.min(...i)}return{groupWidth:n,groupHeight:o,groupLeft:a,groupTop:u,bln:c===1}},formatTransformVal(t){let[e,i]=t.replace(/[^0-9\-,]/g,"").split(",");return i===void 0&&(i=0),[+e,+i]}}},rt={};var Nt=xt(Ht,zt,$t,!1,Wt,null,null,null);function Wt(t){for(let e in rt)this[e]=rt[e]}var lt=function(){return Nt.exports}();const U="ljm-free-layout-editor",k=Mt(U);var Dt={name:`${U}-contextmenu`,props:{isTop:{type:Boolean,default:!1},isBottom:{type:Boolean,default:!1},left:{type:Number,default:0},top:{type:Number,default:0},isShow:Boolean},data(){return{items:[{key:"up",text:"\u4E0A\u79FB",icon:"arrow-up"},{key:"down",text:"\u4E0B\u79FB",icon:"arrow-down"},{key:"top",text:"\u7F6E\u9876",icon:"vertical-align-top"},{key:"bottom",text:"\u7F6E\u5E95",icon:"vertical-align-bottom"},{key:"divider"},{key:"copy",text:"\u590D\u5236",icon:"copy"},{key:"delete",text:"\u5220\u9664",icon:"delete"}]}},computed:{visibleItems(){const{isTop:t,isBottom:e,items:i,isShow:s}=this;return s?t?i.filter(n=>!["up","top"].includes(n.key)):e?i.filter(n=>!["down","bottom"].includes(n.key)):i:[]}},methods:{onClick({key:t}){this.$emit("clickMenu",t)}},render(){const t=arguments[0],{visibleItems:e}=this;return t("a-dropdown",{attrs:{trigger:["contextmenu"]}},[this.$slots.default,t("a-menu",{slot:"overlay",on:{click:this.onClick}},[e.map((i,s)=>i.key==="divider"?t("a-menu-divider",{key:s}):t("a-menu-item",{key:i.key},[t("a-icon",{attrs:{type:i.icon}}),i.text]))])])}},Et={props:{showGrid:{type:Boolean,default:!0},showRefLines:{type:Boolean,default:!0},snap:{type:Boolean,default:!0}},data(){return{items:[{key:"add",name:"\u65B0\u589E",actived:!0},{key:"showGrid",name:"\u7F51\u683C",actived:!0},{key:"showRefLines",name:"\u8F85\u52A9\u7EBF",actived:!0},{key:"snap",name:"\u5438\u9644",actived:!0}]}},methods:{onClick(t){return()=>{if(t==="add"){this.$emit("add");return}this.$emit("toggle",t)}},isActived(t){return!!(t==="add"||t==="showGrid"&&this.showGrid||t==="showRefLines"&&this.showRefLines||t==="snap"&&this.snap)}},render(){const t=arguments[0],{items:e}=this;return t("div",{class:k("tools")},[e.map(i=>t("div",{key:i.key,class:[k("tools-item"),this.isActived(i.key)&&k("tools-item",["active"])],on:{click:this.onClick(i.key)}},[i.name]))])}},R=null,T={};Gt();var $=[];function ut(t){if(t=t||{},t.seed!==void 0&&t.seed!==null&&t.seed===parseInt(t.seed,10))R=t.seed;else if(typeof t.seed=="string")R=jt(t.seed);else{if(t.seed!==void 0&&t.seed!==null)throw new TypeError("The seed value must be an integer or string");R=null}var e,i,s;if(t.count!==null&&t.count!==void 0){for(var n=t.count,o=[],a=0;a<t.count;a++)$.push(!1);for(t.count=null;n>o.length;){var u=ut(t);R!==null&&(t.seed=R),o.push(u)}return t.count=n,o}return e=It(t),i=Ft(e,t),s=_t(e,i,t),Xt([e,i,s],t)}function It(t){if($.length>0){var e=Jt(t.hue),i=B(e),s=(e[1]-e[0])/$.length,n=parseInt((i-e[0])/s);$[n]===!0?n=(n+2)%$.length:$[n]=!0;var o=(e[0]+n*s)%359,a=(e[0]+(n+1)*s)%359;return e=[o,a],i=B(e),i<0&&(i=360+i),i}else{var e=Vt(t.hue);return i=B(e),i<0&&(i=360+i),i}}function Ft(t,e){if(e.hue==="monochrome")return 0;if(e.luminosity==="random")return B([0,100]);var i=Ot(t),s=i[0],n=i[1];switch(e.luminosity){case"bright":s=55;break;case"dark":s=n-10;break;case"light":n=55;break}return B([s,n])}function _t(t,e,i){var s=Yt(t,e),n=100;switch(i.luminosity){case"dark":n=s+20;break;case"light":s=(n+s)/2;break;case"random":s=0,n=100;break}return B([s,n])}function Xt(t,e){switch(e.format){case"hsvArray":return t;case"hslArray":return O(t);case"hsl":var i=O(t);return"hsl("+i[0]+", "+i[1]+"%, "+i[2]+"%)";case"hsla":var s=O(t),a=e.alpha||Math.random();return"hsla("+s[0]+", "+s[1]+"%, "+s[2]+"%, "+a+")";case"rgbArray":return E(t);case"rgb":var n=E(t);return"rgb("+n.join(", ")+")";case"rgba":var o=E(t),a=e.alpha||Math.random();return"rgba("+o.join(", ")+", "+a+")";default:return Ut(t)}}function Yt(t,e){for(var i=I(t).lowerBounds,s=0;s<i.length-1;s++){var n=i[s][0],o=i[s][1],a=i[s+1][0],u=i[s+1][1];if(e>=n&&e<=a){var c=(u-o)/(a-n),h=o-c*n;return c*e+h}}return 0}function Vt(t){if(typeof parseInt(t)=="number"){var e=parseInt(t);if(e<360&&e>0)return[e,e]}if(typeof t=="string"){if(T[t]){var i=T[t];if(i.hueRange)return i.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var s=dt(t)[0];return[s,s]}}return[0,360]}function Ot(t){return I(t).saturationRange}function I(t){t>=334&&t<=360&&(t-=360);for(var e in T){var i=T[e];if(i.hueRange&&t>=i.hueRange[0]&&t<=i.hueRange[1])return T[e]}return"Color not found"}function B(t){if(R===null){var e=.618033988749895,i=Math.random();return i+=e,i%=1,Math.floor(t[0]+i*(t[1]+1-t[0]))}else{var s=t[1]||1,n=t[0]||0;R=(R*9301+49297)%233280;var o=R/233280;return Math.floor(n+o*(s-n))}}function Ut(t){var e=E(t);function i(n){var o=n.toString(16);return o.length==1?"0"+o:o}var s="#"+i(e[0])+i(e[1])+i(e[2]);return s}function L(t,e,i){var s=i[0][0],n=i[i.length-1][0],o=i[i.length-1][1],a=i[0][1];T[t]={hueRange:e,lowerBounds:i,saturationRange:[s,n],brightnessRange:[o,a]}}function Gt(){L("monochrome",null,[[0,0],[100,0]]),L("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),L("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),L("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),L("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),L("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),L("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),L("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function E(t){var e=t[0];e===0&&(e=1),e===360&&(e=359),e=e/360;var i=t[1]/100,s=t[2]/100,n=Math.floor(e*6),o=e*6-n,a=s*(1-i),u=s*(1-o*i),c=s*(1-(1-o)*i),h=256,d=256,m=256;switch(n){case 0:h=s,d=c,m=a;break;case 1:h=u,d=s,m=a;break;case 2:h=a,d=s,m=c;break;case 3:h=a,d=u,m=s;break;case 4:h=c,d=a,m=s;break;case 5:h=s,d=a,m=u;break}var f=[Math.floor(h*255),Math.floor(d*255),Math.floor(m*255)];return f}function dt(t){t=t.replace(/^#/,""),t=t.length===3?t.replace(/(.)/g,"$1$1"):t;var e=parseInt(t.substr(0,2),16)/255,i=parseInt(t.substr(2,2),16)/255,s=parseInt(t.substr(4,2),16)/255,n=Math.max(e,i,s),o=n-Math.min(e,i,s),a=n?o/n:0;switch(n){case e:return[60*((i-s)/o%6)||0,a,n];case i:return[60*((s-e)/o+2)||0,a,n];case s:return[60*((e-i)/o+4)||0,a,n]}}function O(t){var e=t[0],i=t[1]/100,s=t[2]/100,n=(2-i)*s;return[e,Math.round(i*s/(n<1?n:2-n)*1e4)/100,n/2*100]}function jt(t){for(var e=0,i=0;i!==t.length&&!(e>=Number.MAX_SAFE_INTEGER);i++)e+=t.charCodeAt(i);return e}function Jt(t){if(isNaN(t)){if(typeof t=="string"){if(T[t]){var i=T[t];if(i.hueRange)return i.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var s=dt(t)[0];return I(s).hueRange}}}else{var e=parseInt(t);if(e<360&&e>0)return I(t).hueRange}}const qt=()=>{},Kt=()=>ut({luminosity:"light"});var Qt={name:U,props:{moduleProps:{type:Object,default:()=>({blocks:[],height:300,bgColor:"rgba(210,224,67,.5)"})}},data(){return{vLine:[],hLine:[],snap:!0,showRefLines:!0,showGrid:!0,activedIndex:null}},computed:{isTop(){const t=this.moduleProps.blocks.length;return this.activedIndex===t-1},isBottom(){return this.activedIndex===0},containerWidth(){const[,t,,e]=this.moduleProps.wrapPadding;return 375-t-e}},watch:{containerWidth(t){this.refreshDragArea()}},methods:{getBlockStyle(t){const{x:e,y:i,bgColor:s,img:n,radius:o}=t,a={backgroundColor:s,borderRadius:o+"px"};return n&&n.url&&(a.backgroundImage=`url(${n.url})`),a},addBlock(){this.moduleProps.blocks.push(new A({x:8,y:8,bgColor:Kt()}))},getRefLineParams(t){const{vLine:e,hLine:i}=t;this.vLine=e,this.hLine=i},onParentResizeStop(t,e,i,s){this.moduleProps.height=s,this.refreshDragArea()},onResizeStop(t){return(e,i,s,n)=>{const{blocks:o}=this.moduleProps,a=o.slice();a[t].width=s,a[t].height=n,this.moduleProps.blocks=a}},onDragStop(t){return(e,i)=>{const{blocks:s}=this.moduleProps,n=s.slice();n[t].x=e,n[t].y=i,this.moduleProps.blocks=n}},onClickMenu(t){const e=this.activedIndex;let i=[...this.moduleProps.blocks];if(e===null)return;let s=e;const n=i[e];t==="top"&&(i.splice(e,1),i.push(n),s=i.length-1),t==="bottom"&&(i.splice(e,1),i.unshift(n),s=0),t==="up"&&(i[e]=i[e+1],i[e+1]=n,s=e+1),t==="down"&&(i[e]=i[e-1],i[e-1]=n,s=e-1),t==="copy"&&(i.push(n.clone()),s=i.length-1),t==="delete"&&(i.splice(e,1),s=i.length>0?e-1:null),this.moduleProps.blocks=i,this.activedIndex=s,this.refreshDragArea()},onActivated(t){return()=>{console.log(t),this.activedIndex=t}},onDeactivated(t){return()=>{this.activedIndex===t&&(this.activedIndex=null)}},onToolsToggle(t){this[t]=!this[t]},onChangeHeight(){this.refreshDragArea()},refreshDragArea(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),this.refreshTimer=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300)}},render(){const t=arguments[0],{vLine:e,hLine:i,showGrid:s,showRefLines:n,snap:o,isTop:a,isBottom:u,activedIndex:c}=this,{blocks:h,height:d,bgColor:m,bgImg:f}=this.moduleProps,r=h[c];return t("div",[t(Et,{attrs:{showGrid:s,showRefLines:n,snap:o},on:{toggle:this.onToolsToggle,add:this.addBlock}}),t("div",{style:{height:d,marginBottom:"10px"}},[t(lt,{class:[k(),!s&&[k(["nogrid"])]],attrs:{preventDeactivation:!0,handles:["bm"],classNameHandle:k("handle"),draggable:!1,w:this.containerWidth,h:d},on:{resizestop:this.onParentResizeStop}},[h.map((l,g)=>t(lt,{attrs:{w:l.width,h:l.height,x:l.x,y:l.y,parent:!0,zIndex:g,classNameHandle:k("handle"),classNameActive:k("active"),snap:o,active:c===g,grid:s?[4,4]:[1,1]},key:l.id,on:{activated:this.onActivated(g),deactivated:this.onDeactivated(g),resizing:this.onResizeStop(g),dragging:this.onDragStop(g),refLineParams:n?this.getRefLineParams:qt}},[t(Dt,{attrs:{isTop:a,isBottom:u,isShow:this.activedIndex!==null},on:{clickMenu:this.onClickMenu}},[t("div",{class:k("content"),style:this.getBlockStyle(l)})]),t("div",{class:k("size")},[t("div",{class:k("size-text")},[l.width,"x",l.height])])])),e.map((l,g)=>t("span",{class:"ref-line v-line",style:{left:l.position,top:l.origin,height:l.lineLength,opacity:l.display?1:0}})),i.map((l,g)=>t("span",{class:"ref-line h-line",style:{top:l.position,left:l.origin,width:l.lineLength,opacity:l.display?1:0}}))])]),t("a-form",{attrs:{labelCol:{span:4},wrapperCol:{span:20}}},[t("a-form-item",{attrs:{label:"\u80CC\u666F\u8272"}},[t("ext-color-picker",{model:{value:this.moduleProps.bgColor,callback:l=>{this.$set(this.moduleProps,"bgColor",l)}}})]),t("a-form-item",{attrs:{label:"\u80CC\u666F\u56FE"}},[t("ext-img-select",{model:{value:this.moduleProps.bgImg,callback:l=>{this.$set(this.moduleProps,"bgImg",l)}}})]),t("a-form-item",{attrs:{label:"\u9AD8\u5EA6"}},[t("ext-props-input",{on:{change:this.onChangeHeight},attrs:{icon:"icon-resize-v",min:100},model:{value:this.moduleProps.height,callback:l=>{this.$set(this.moduleProps,"height",l)}}})]),!!r&&t("div",[t("h3",{class:"section-tit"},["\u5757\u6837\u5F0F"]),t("a-form-item",{attrs:{label:"\u4F4D\u7F6E"}},[t("div",{style:"display: flex;"},[t("ext-props-input",{attrs:{icon:"icon-x"},model:{value:r.x,callback:l=>{this.$set(r,"x",l)}}}),t("div",{style:"width: 8px"}),t("ext-props-input",{attrs:{icon:"icon-Y"},model:{value:r.y,callback:l=>{this.$set(r,"y",l)}}})])]),t("a-form-item",{attrs:{label:"\u5927\u5C0F"}},[t("div",{style:"display: flex;"},[t("ext-props-input",{attrs:{icon:"icon-width"},model:{value:r.width,callback:l=>{this.$set(r,"width",l)}}}),t("div",{style:"width: 8px"}),t("ext-props-input",{attrs:{icon:"icon-height"},model:{value:r.height,callback:l=>{this.$set(r,"height",l)}}})])]),t("a-form-item",{attrs:{label:"\u5706\u89D2"}},[t("ext-props-input",{attrs:{unit:"\u02DA",icon:"icon-yuanjiao2"},model:{value:r.radius,callback:l=>{this.$set(r,"radius",l)}}})]),t("a-form-item",{attrs:{label:"\u56FE\u7247"}},[t("ext-img-select",{model:{value:r.img,callback:l=>{this.$set(r,"img",l)}}})]),t("a-form-item",{attrs:{label:"\u94FE\u63A5"}},[t("ext-link-select",{model:{value:r.link,callback:l=>{this.$set(r,"link",l)}}})]),t("a-form-item",{attrs:{label:"\u80CC\u666F\u8272"}},[t("ext-color-picker",{model:{value:r.bgColor,callback:l=>{this.$set(r,"bgColor",l)}}})])])])])}};const{defaultProps:Zt,editProps:te,wrapEditProps:ee,hasCustomEditor:ie}=St(ct);var he={data(){return{moduleProps:Zt}},render(){const t=arguments[0];return t("div",[t("demo-layout",{attrs:{editProps:te,wrapEditProps:ee,defaultProps:this.moduleProps},scopedSlots:{left:e=>t(ct,st([{},{props:X({},e)}])),right:e=>ie?t(Qt,st([{},{props:{moduleProps:e}}])):null}})])}};export{he as default};
